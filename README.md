# decompose_insar_velocities
"decompose_insar_velocities" is a set of matlab scripts for performing a velocity decomposition (e.g. REF) on multiple overlapping InSAR velocity fields.
The code has been written to use InSAR LOS velocities generated by LiCSBAS (https://github.com/yumorishita/LiCSBAS), using interferograms from the COMET-LiCS project (https://comet.nerc.ac.uk/COMET-LiCS-portal/), although any LOS velocities may be used if they are correctly formatted as geotifs.

## Processing stages
"decompose_insar_velocities" (DIV) works through the following processing steps, many of which can be altered using within the config file:
1)
2)
3)

## Config file
The example config file provides short descriptions of each option. Below, we give greater details:

### para_cores
The number of parallel processes to run for the decomposition, which is performed pixel-by-pixel.

### ties2gnss
Shift relative InSAR velocities into a common reference frame defined by a network of GNSS velocities (e.g. relative -> Eurasia-fixed).
This is performed by calculating the residual between the interpolated East and North GNSS velocities projected into the line-of-sight of each frame, and the InSAR line-of-sight velocities.
We extract the long-wavelength signals from the residual, and subtract these from each frame.
Two methods for handling the residuals are currently included:
 - 0 - disables the referencing.
 - 1 - fit a 2nd order polynomial surface to the residual (based on Weiss et al. 2020).
 - 2 - apply a gaussian filter to the residuals (based on Xu et al. 2021).

### ds_factor and ds_method
Applies downsampling to the input velocities, taking either the mean or the median of a given window size (ds_factor x ds_factor).
This can improve the computational requirements of later steps (useful for testing).

### usemask
Using pre-masked velocities can lead to smearing or shrinking of the masked area if additional downsapling is performed within DIV.
Hence, we recommend providing unmasked velocities and a matching mask file, which is then optionally applied after both regridding and downsampling.

### merge_along_track
Merge overlapping frames within each track.
This requires that the frame directories have been given in order for each track.
Options are:
 - 0 - disables.
 - 1 - apply the shift to each frame, but leave the frames seperate (i.e. don't take the mean to fully merge them).
 - 2 - take the mean of overlapping points, combining multiple frames into a single array.
